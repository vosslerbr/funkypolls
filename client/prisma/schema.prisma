// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

enum Status {
  DRAFT
  OPEN
  EXPIRED
  ARCHIVED
}

enum Expiration {
  FIVE_MINUTES
  TEN_MINUTES
  FIFTEEN_MINUTES
}

enum Type {
  SINGLE_SELECT
  MULTI_SELECT
  BOOLEAN
  SLIDER
  RANGE
  RANKING
}

model Poll {
  id        String      @id @default(cuid())
  name     String
  expiration Expiration @default(FIVE_MINUTES)
  expirationDate DateTime @default(now()) // updated when poll gets opened
  questions   Question[]
  passcode  String
  requirePasscodeToView Boolean @default(false)
  userId    String // poll creator's Clerk ID
  status Status @default(DRAFT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt


}

model Question {
  id        String      @id @default(cuid())
  question     String
  poll      Poll        @relation(fields: [pollId], references: [id], onDelete: Cascade)
  pollId    String
  options   Option[]
  type Type @default(SINGLE_SELECT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([pollId], name: "pollId")
}

model Option {
  id        String      @id @default(cuid())
  text      String
  votes     Int        @default(0) // TODO replace with an 'answer' relation
  question      Question     @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([questionId], name: "questionId")
  @@unique([questionId, text], name: "questionId_text_unique")
}